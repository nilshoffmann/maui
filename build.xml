<?xml version="1.0" encoding="UTF-8"?>
<!-- You may freely edit this file. See harness/README in the NetBeans platform -->
<!-- for some information on what you could do (e.g. targets to override). -->
<!-- If you delete this file and reopen the project it will be recreated. -->
<project name="ChromAUI" basedir=".">
    <description>Builds the module suite Maui.</description>
    <import file="${basedir}/../nbproject/platform-defaults.xml"/>
    <import file="nbproject/build-impl.xml"/>
	
	<property name="project.release.name" value="maui"/>
    <property name="project.release.version" value="1.2"/>
    <property name="project.release.path" value="${project.release.name}/${project.release.version}"/>
    
    <!-- Modify NetBeans app.conf file to use my local one-->
   <target name="build-launchers" depends="suite.build-launchers">
       <echo message="Branding conf file : Copy file ${basedir}/BrandingModule/harness/etc/maui.conf to ${build.launcher.dir}/etc/${app.name}.conf"/>
       <delete file="${build.launcher.dir}/etc/${app.name}.conf"/>
       <copy file="${basedir}/BrandingModule/harness/etc/${app.name}.conf" tofile="${build.launcher.dir}/etc/${app.name}.conf"/>
	   <copy file="${basedir}/BrandingModule/harness/bin/${app.name}-sge.sh" tofile="${build.launcher.dir}/bin"/>
   </target>   
   
   	<!-- additional task to fix dependencies for all modules at once -->
    <target name="fix-dependencies" depends="-init">
       <subant target="fix-dependencies" buildpath="${modules.sorted}" inheritrefs="false" inheritall="false"/>
    </target>
    
    <target name="fix-test-dependencies" depends="-init">
       <subant target="fix-test-dependencies" buildpath="${modules.sorted}" inheritrefs="false" inheritall="false"/>
    </target>
	
	<target name="check-installers" description="Check that installers are ready">
		<fail message="Installers have not been created! Please create them manually!">
			<condition>
				<and>
					<not>
						<available file="dist/maui-linux.sh"/>
					</not>
					<not>
						<available file="dist/maui-macosx.tgz"/>
					</not>					
					<not>
						<available file="dist/maui-solaris.sh"/>
					</not>
					<not>
						<available file="dist/maui-windows.exe"/>
					</not>
				</and>
			</condition>
		</fail>
	</target>
	
	<target name="prepare-release" description="Prepares a release" depends="build,test,nbms,check-installers">
    </target>

<!--    <target name="deploy" description="Deploys release files" depends="prepare-release,upload-credentials,upload-updatecenter,upload-build,upload-homepage">
    </target>-->
    <target name="deploy" description="Deploys release files" depends="prepare-release,upload-credentials,upload-updatecenter,upload-homepage,upload-build">
    </target>
    
    <target name="upload-credentials" description="Ask for user credentials">
        <input addproperty="upload.username">Please enter username for upload:</input>
                <!--<input message="Please supply password for user ${sf.username}:" addproperty="sf.username.password">
                        <handler type="secure"/>
                </input>-->
    </target>
    
    <target name="upload-homepage" description="Deploys homepage" depends="upload-credentials">
        <exec command="rsync" inputstring="">
            <arg value="-avtruP"/>
            <arg value="-e ssh "/>
            <arg value="site/public_html/"/>
            <arg value="${upload.username},maltcms@web.sourceforge.net:htdocs/${project.release.path}/"/>
        </exec>    
    </target>
    
    <target name="upload-updatecenter" description="Upload results of beta build" depends="upload-credentials,nbms">
                <!--<echo message="Do not forget to supply -Dusername -Dpassword to ant when running the upload target!" />-->
                <!--<scp todir="${sf.username},maltcms@web.sourceforge.net:htdocs/" password="${sf.username.password}" sftp="true" trust="true" verbose="true">
                        <fileset dir="${release_dir}/site/" />
                </scp>-->
        <exec command="rsync" inputstring="">
            <arg value="-avtruP"/>
            <arg value="-e ssh "/>
            <arg value="build/updates/"/>
            <arg value="${upload.username},maltcms@frs.sourceforge.net:/home/frs/project/m/ma/maltcms/${project.release.path}/updates/"/>
        </exec>
    </target>
    <target name="upload-build" description="Deploys the distribution installers and zip file" depends="upload-credentials">
        <tstamp>
            <format property="deploy.time" pattern="yyyy-MM-dd"/>
        </tstamp>
        <exec command="rsync" inputstring="">
            <arg value="-avtruP"/>
            <arg value="-e ssh "/>
            <arg value="dist/"/>
            <arg value="${upload.username},maltcms@frs.sourceforge.net:/home/frs/project/m/ma/maltcms/${project.release.path}/"/>
        </exec>    
    </target>
</project>
