/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package net.sf.maltcms.common.charts.overlay.ui;

import java.awt.BorderLayout;
import java.beans.IntrospectionException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.Comparator;
import java.util.List;
import javax.swing.ActionMap;
import net.sf.maltcms.common.charts.overlay.ChartOverlay;
import net.sf.maltcms.common.charts.overlay.nodes.OverlayNode;
import org.netbeans.swing.outline.Outline;
import org.openide.explorer.ExplorerManager;
import org.openide.explorer.ExplorerUtils;
import org.openide.explorer.view.OutlineView;
import org.openide.nodes.AbstractNode;
import org.openide.nodes.ChildFactory;
import org.openide.nodes.Children;
import org.openide.nodes.Node;
import org.openide.util.Exceptions;
import org.openide.util.Lookup;

/**
 *
 * @author Nils Hoffmann
 */
public class OverlayNavigatorPanelUI extends javax.swing.JPanel implements ExplorerManager.Provider, Lookup.Provider {

    private ExplorerManager manager;
    private Lookup lookup;
    /**
     * Creates new form OverlayNavigatorPanelUI
     */
    public OverlayNavigatorPanelUI() {
        manager = new ExplorerManager();
        ActionMap map = getActionMap();
        initComponents();
        OutlineView outline = new OutlineView("Overlays");
        Outline o = outline.getOutline();
        o.setRootVisible(false);
        add(outline,BorderLayout.CENTER);
        lookup = ExplorerUtils.createLookup (manager, map);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        setLayout(new java.awt.BorderLayout());
    }// </editor-fold>//GEN-END:initComponents
    // Variables declaration - do not modify//GEN-BEGIN:variables
    // End of variables declaration//GEN-END:variables

    @Override
    public ExplorerManager getExplorerManager() {
        return manager;
    }
    
    @Override
    public Lookup getLookup() {
        return lookup;
    }

    @Override
    public void addNotify() {
        super.addNotify();
        ExplorerUtils.activateActions(manager, true);
    }
    
    @Override
    public void removeNotify() {
        ExplorerUtils.activateActions(manager, false);
        super.removeNotify();
    }
    
    public void setContent(Collection<? extends ChartOverlay> overlays) {
        final List<ChartOverlay> l = new ArrayList<ChartOverlay>(overlays);
        Collections.sort(l,new Comparator<ChartOverlay>() {

            @Override
            public int compare(ChartOverlay t, ChartOverlay t1) {
                return t.getLayerPosition()-t1.getLayerPosition();
            }
        });
        Node root = new AbstractNode(Children.create(new ChildFactory<ChartOverlay>() {

            @Override
            protected boolean createKeys(List<ChartOverlay> toPopulate) {
                toPopulate.addAll(l);
                return true;
            }

            @Override
            protected Node createNodeForKey(ChartOverlay key) {
                try {
                    OverlayNode node = new OverlayNode(key);
                    return node;
                } catch (IntrospectionException ex) {
                    Exceptions.printStackTrace(ex);
                    return Node.EMPTY;
                }
            }
            
            
        }, true));
        manager.setRootContext(root);
    }
}
